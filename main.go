package main

import (
	"encoding/json"
	"fmt"
	"github.com/go-resty/resty/v2"
	"github.com/spf13/viper"
	"os"
	"path/filepath"
	"time"
)

var outputDir string
var lixingerToken string
var mainlandStockCodes []string



func init() {
	// 获取程序运行目录
	clientRunDir, getClientRunDirErr := filepath.Abs(filepath.Dir(os.Args[0]))
	if getClientRunDirErr != nil {
		fmt.Println(getClientRunDirErr)
		os.Exit(-1)
	}
	// 设置配置文件
	configFile := clientRunDir + "/config/env"
	viper.SetConfigFile(configFile)
	viper.SetConfigType("yaml")
	// 读取配置
	readConfigErr := viper.ReadInConfig()
	if readConfigErr != nil {
		fmt.Println(readConfigErr)
		os.Exit(-2)

	}
	// 获取 excel 输出目录
	outputDir = viper.GetString("outputDir")
	lixingerToken = viper.GetString("lixingerToken")
	mainlandStockCodes = viper.GetStringSlice("mainlandStockCodes")

	t, _ := time.Parse(time.RFC3339, "2021-06-15T00:00:00+08:00")
	fmt.Println("hour", t.Hour())
	fmt.Println("year", t.Year())
	fmt.Println("month", t.Month())
	fmt.Println("day", t.Day())
}
//{"code":1,"message":"success","data":[{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.010063459776265132,"ewpvo":0.014442405632627345,"mcw":0.01688781374436047},"pb":{"y10":{"ew":{"avgv":2.7033700192993564,"cv":2.39387508879371,"cvpos":0.4590703414232826,"maxpv":6.216782858867069,"maxv":6.216782858867069,"minv":1.654831065303109,"q2v":2.1377021763316755,"q5v":2.449511870332364,"q8v":3.34047460273873},"ewpvo":{"avgv":2.6590200686051153,"cv":2.0909305295659317,"cvpos":0.2398190045248869,"maxpv":6.179452787664063,"maxv":6.179452787664063,"minv":1.6422848896731184,"q2v":2.0437805622695584,"q5v":2.367060133121327,"q8v":3.3055976284382704},"mcw":{"avgv":1.902219058676635,"cv":1.985590666716165,"cvpos":0.6018099547511312,"maxpv":3.5697787666778544,"maxv":3.5697787666778544,"minv":1.399281175332533,"q2v":1.641116371420264,"q5v":1.909473851289597,"q8v":2.1188720787627773}}},"pe_ttm":{"y10":{"ew":{"avgv":40.84745115521122,"cv":-34.524655191803156,"cvpos":0.900041135335253,"maxpv":3291.3596320233096,"maxv":-18.979630897951633,"minv":26.588897192873947,"q2v":38.605489552010916,"q5v":50.93812024900224,"q8v":-285.1792840117928},"ewpvo":{"avgv":32.23862624030366,"cv":23.76271216618908,"cvpos":0.12381735911147676,"maxpv":76.0946886141782,"maxv":76.0946886141782,"minv":19.58065108818252,"q2v":24.60957134306495,"q5v":27.981223176488328,"q8v":41.10696564621494},"mcw":{"avgv":17.42612890720808,"cv":20.358220880506543,"cvpos":0.7334430275606746,"maxpv":31.156894973996376,"maxv":31.156894973996376,"minv":11.44987372577837,"q2v":13.405242931877636,"q5v":17.198091751299657,"q8v":21.30359670451469}}},"cp":5699.5462,"cpc":-0.009761849959400479,"stockCode":"1000002"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.01660220528709022,"ewpvo":0.01798072774775114,"mcw":0.02171587384082683},"pb":{"y10":{"ew":{"avgv":2.01436882336836,"cv":2.034207213264172,"cvpos":0.5828877005347594,"maxpv":4.014765315865202,"maxv":4.014765315865202,"minv":1.476537426433681,"q2v":1.7083077270435951,"q5v":1.9484191724900528,"q8v":2.314079407184196},"ewpvo":{"avgv":2.0141540232372876,"cv":2.034207213264172,"cvpos":0.5828877005347594,"maxpv":4.014765315865202,"maxv":4.014765315865202,"minv":1.476537426433681,"q2v":1.7083077270435951,"q5v":1.9456585067706391,"q8v":2.314079407184196},"mcw":{"avgv":1.5801884023801118,"cv":1.7251728169716907,"cvpos":0.7873303167420814,"maxpv":2.5300079959330968,"maxv":2.5300079959330968,"minv":1.1700668855884566,"q2v":1.388826619876689,"q5v":1.531366233386894,"q8v":1.7375408614579408}}},"pe_ttm":{"y10":{"ew":{"avgv":19.873779090680397,"cv":19.019222625304536,"cvpos":0.5104895104895105,"maxpv":36.41282603347769,"maxv":36.41282603347769,"minv":13.653231384206656,"q2v":16.76372254171042,"q5v":18.946697345420645,"q8v":23.085107115758383},"ewpvo":{"avgv":18.18511589582362,"cv":17.193468526620816,"cvpos":0.4784039489921843,"maxpv":34.03153311631586,"maxv":34.03153311631586,"minv":13.167179655958993,"q2v":15.338344370477909,"q5v":17.37370489114206,"q8v":21.11127093322013},"mcw":{"avgv":12.124399765095328,"cv":14.67192782195845,"cvpos":0.8918140682846565,"maxpv":19.01219329481535,"maxv":19.01219329481535,"minv":8.01130784179585,"q2v":10.342882309886711,"q5v":12.044146334587872,"q8v":14.00185560870943}}},"cp":5166.56,"cpc":-0.011127911650429579,"stockCode":"000300"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.015929347035660603,"ewpvo":0.018873633928507823,"mcw":0.015132211188494083},"pb":{"y10":{"ew":{"avgv":2.282631370556352,"cv":1.7075240887997014,"cvpos":0.17523652817770466,"maxpv":5.4856633546702644,"maxv":5.4856633546702644,"minv":1.373774957631363,"q2v":1.726900437308665,"q5v":2.1524115984011987,"q8v":2.776058823924461},"ewpvo":{"avgv":2.2843961177841083,"cv":1.7075240887997014,"cvpos":0.17564788153023447,"maxpv":5.4856633546702644,"maxv":5.4856633546702644,"minv":1.373774957631363,"q2v":1.726899092351561,"q5v":2.1524115984011987,"q8v":2.776058823924461},"mcw":{"avgv":2.4538586860523,"cv":1.9605030571895976,"cvpos":0.17688194158782394,"maxpv":5.864903495168779,"maxv":5.864903495168779,"minv":1.5344074972018051,"q2v":2.011257845301554,"q5v":2.35698253905637,"q8v":2.897630973879579}}},"pe_ttm":{"y10":{"ew":{"avgv":34.31742267463834,"cv":21.668383930433713,"cvpos":0.027149321266968326,"maxpv":144.15314699776803,"maxv":144.15314699776803,"minv":17.071668314159723,"q2v":28.11364506489222,"q5v":32.43558060072871,"q8v":43.70820793308065},"ewpvo":{"avgv":27.201739051124964,"cv":17.595409733024756,"cvpos":0.04113533525298231,"maxpv":65.5514437308845,"maxv":65.5514437308845,"minv":15.245887550235754,"q2v":20.47734238425504,"q5v":24.957017795200628,"q8v":33.83907078170632},"mcw":{"avgv":31.727672476579134,"cv":21.570441701483816,"cvpos":0.062114356232003294,"maxpv":81.43928125748197,"maxv":81.43928125748197,"minv":16.025240541582416,"q2v":25.68089411186141,"q5v":29.628709138662508,"q8v":41.71543493625512}}},"cp":6663.66,"cpc":-0.00925672621737996,"stockCode":"000905"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.0009015012168207344,"ewpvo":0.00631050851774514,"mcw":0.0010654132078360542},"pb":{"y10":{"ew":{"avgv":2.316542077940072,"cv":3.8364724116063327,"cvpos":0.9340463458110517,"maxpv":5.79718569199311,"maxv":5.79718569199311,"minv":0.9729130821747949,"q2v":1.7350299162590852,"q5v":2.128568470805827,"q8v":3.048891091950229},"ewpvo":{"avgv":2.237197389623319,"cv":3.6485923669769247,"cvpos":0.9114676173499703,"maxpv":5.45241953926599,"maxv":5.45241953926599,"minv":0.9729130821747949,"q2v":1.7217845817730784,"q5v":2.0760077467252804,"q8v":2.7766126673668596},"mcw":{"avgv":6.723333396270008,"cv":5.202405282298417,"cvpos":0.11942959001782531,"maxpv":10.205378843975758,"maxv":10.205378843975758,"minv":4.4526070948926035,"q2v":5.609292294364662,"q5v":6.597462053140507,"q8v":8.03140489317381}}},"pe_ttm":{"y10":{"ew":{"avgv":22.096256516252986,"cv":-80.72017207025502,"cvpos":0.3582887700534759,"maxpv":14258.605286282262,"maxv":-5.419150941741266,"minv":19.265745059857338,"q2v":163.5005330492892,"q5v":-43.24908440059788,"q8v":-14.777852784548596},"ewpvo":{"avgv":19.442808631108996,"cv":19.59974482798858,"cvpos":0.5335710041592394,"maxpv":37.252694116063886,"maxv":37.252694116063886,"minv":9.468620002810306,"q2v":14.01778970828525,"q5v":19.257609222445552,"q8v":24.200447903421125},"mcw":{"avgv":61.09043132276232,"cv":50.33563151102501,"cvpos":0.34878193701723115,"maxpv":135.27259379478323,"maxv":135.27259379478323,"minv":31.786101364820617,"q2v":46.58310265698706,"q5v":58.95202681686878,"q8v":76.55220612946361}}},"cp":8154.71,"cpc":-0.013935813415075608,"stockCode":"H11136"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.0008834711924843198,"ewpvo":0.00631050851774514,"mcw":0.001028836665868639},"pb":{"y10":{"ew":{"avgv":2.3195171312119873,"cv":3.84805327011845,"cvpos":0.9328978622327792,"maxpv":5.819446038795444,"maxv":5.819446038795444,"minv":0.9729130821747949,"q2v":1.7350299162590852,"q5v":2.129378632011301,"q8v":3.048891091950229},"ewpvo":{"avgv":2.240443061472518,"cv":3.663251460363573,"cvpos":0.9091448931116389,"maxpv":5.481050873534197,"maxv":5.481050873534197,"minv":0.9729130821747949,"q2v":1.7217845817730784,"q5v":2.0762943479517224,"q8v":2.7766126673668596},"mcw":{"avgv":6.718872917459415,"cv":5.175400973201241,"cvpos":0.11282660332541568,"maxpv":10.205378843975758,"maxv":10.205378843975758,"minv":4.4526070948926035,"q2v":5.609292294364662,"q5v":6.561204619570442,"q8v":8.014751623473517}}},"pe_ttm":{"y10":{"ew":{"avgv":22.066593668323414,"cv":-88.79463229921622,"cvpos":0.33669833729216153,"maxpv":14258.605286282262,"maxv":-5.419150941741266,"minv":19.265745059857338,"q2v":155.31035973101655,"q5v":-43.255729177704325,"q8v":-14.777852784548596},"ewpvo":{"avgv":19.478166636307844,"cv":19.701038091539836,"cvpos":0.5380047505938242,"maxpv":37.51910346316618,"maxv":37.51910346316618,"minv":9.468620002810306,"q2v":14.01778970828525,"q5v":19.257518622283847,"q8v":24.337670944628748},"mcw":{"avgv":60.98174745319639,"cv":48.3254221347999,"cvpos":0.2660332541567696,"maxpv":135.27259379478323,"maxv":135.27259379478323,"minv":31.786101364820617,"q2v":46.474476316582816,"q5v":58.70402990852553,"q8v":76.55220612946361}}},"cp":12216.7,"cpc":-0.006284386804577077,"stockCode":"H30533"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.012683597574213503,"ewpvo":0.014999732783417707,"mcw":0.010502608097717052},"pb":{"y10":{"ew":{"avgv":3.1686549790059573,"cv":3.152448956326242,"cvpos":0.493116395494368,"maxpv":6.441436659275059,"maxv":6.441436659275059,"minv":1.9642037363701936,"q2v":2.7181400711468546,"q5v":3.1623604896285733,"q8v":3.6784931008309747},"ewpvo":{"avgv":3.165951098174841,"cv":3.0417050311068974,"cvpos":0.43137254901960786,"maxpv":6.441436659275059,"maxv":6.441436659275059,"minv":1.9492559697943712,"q2v":2.7154446919021242,"q5v":3.1521592562597487,"q8v":3.6784931008309747},"mcw":{"avgv":4.614636503755571,"cv":7.901615289328302,"cvpos":0.9586983729662077,"maxpv":9.657915271480615,"maxv":9.657915271480615,"minv":2.7646654123247405,"q2v":3.5620941407756406,"q5v":4.230006761917656,"q8v":5.4849916993760806}}},"pe_ttm":{"y10":{"ew":{"avgv":45.90021935057928,"cv":53.24106927378992,"cvpos":0.7188151856487276,"maxpv":12169.72344407136,"maxv":-299.30408638577734,"minv":28.765937065970835,"q2v":36.01871260191534,"q5v":43.051246736026954,"q8v":56.11837829011962},"ewpvo":{"avgv":35.16300931570583,"cv":25.465422455338246,"cvpos":0.03379224030037547,"maxpv":75.67403306664832,"maxv":75.67403306664832,"minv":23.386385737851004,"q2v":28.137372323272643,"q5v":33.061838143605314,"q8v":41.41826062741768},"mcw":{"avgv":30.04767347166139,"cv":41.33585103460761,"cvpos":0.9695452649144765,"maxpv":48.818342720701885,"maxv":48.818342720701885,"minv":18.939651804139178,"q2v":23.922708543958752,"q5v":30.266628762365396,"q8v":34.772045385264235}}},"cp":23150.5879,"cpc":-0.006910492018484918,"stockCode":"000990"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.005714111948239295,"ewpvo":0.007344409424996834,"mcw":0.006332645719041405},"pb":{"y10":{"ew":{"avgv":3.7909858264285474,"cv":3.199858840598976,"cvpos":0.36337088026700043,"maxpv":10.424798313928374,"maxv":10.424798313928374,"minv":1.9735826995063985,"q2v":2.8829691128851893,"q5v":3.5227274384858385,"q8v":4.825561514585122},"ewpvo":{"avgv":3.7923532112069656,"cv":3.1837881144877986,"cvpos":0.35836462244472256,"maxpv":10.424798313928374,"maxv":10.424798313928374,"minv":1.9735826995063985,"q2v":2.877592367921376,"q5v":3.521442517269315,"q8v":4.825561514585122},"mcw":{"avgv":4.138890699897767,"cv":4.426262859350159,"cvpos":0.624113475177305,"maxpv":11.234635001338269,"maxv":11.234635001338269,"minv":2.3339892780303604,"q2v":3.2826858239516836,"q5v":4.160515194666243,"q8v":4.84704306939358}}},"pe_ttm":{"y10":{"ew":{"avgv":52.91645111166217,"cv":362.8888412550315,"cvpos":0.853566958698373,"maxpv":4258.225811616379,"maxv":-60.56983174630747,"minv":34.05908305989729,"q2v":44.727359709679774,"q5v":70.7383379136482,"q8v":176.17579533376204},"ewpvo":{"avgv":50.83960010164982,"cv":39.04798880078661,"cvpos":0.24113475177304963,"maxpv":140.06439760476295,"maxv":140.06439760476295,"minv":26.675572120980107,"q2v":37.91613188232573,"q5v":47.9051127745429,"q8v":63.899044816898105},"mcw":{"avgv":56.23213182321652,"cv":57.58077086597958,"cvpos":0.5682102628285357,"maxpv":133.72097203570328,"maxv":133.72097203570328,"minv":27.928951033333504,"q2v":41.01230143910331,"q5v":55.231530222941515,"q8v":70.24589624408733}}},"cp":6853.44,"cpc":0.0029297189401499583,"stockCode":"000993"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.009859531208115606,"ewpvo":0.012348818790362615,"mcw":0.006680863059941285},"pb":{"y10":{"ew":{"avgv":3.675565825257414,"cv":3.0282357166764653,"cvpos":0.23195661243220692,"maxpv":8.311330254728905,"maxv":8.311330254728905,"minv":2.1452266208757105,"q2v":2.9317289564176447,"q5v":3.6596397258476587,"q8v":4.372447238793115},"ewpvo":{"avgv":3.675565825257414,"cv":3.0282357166764653,"cvpos":0.23195661243220692,"maxpv":8.311330254728905,"maxv":8.311330254728905,"minv":2.1452266208757105,"q2v":2.9317289564176447,"q5v":3.6596397258476587,"q8v":4.372447238793115},"mcw":{"avgv":4.387015765290587,"cv":5.7180270899686745,"cvpos":0.9032123487692949,"maxpv":8.412701579475838,"maxv":8.412701579475838,"minv":2.768478375642144,"q2v":3.8008523811616626,"q5v":4.3067154493600395,"q8v":4.983333820225244}}},"pe_ttm":{"y10":{"ew":{"avgv":40.49964723144916,"cv":36.34420833177616,"cvpos":0.17772215269086358,"maxpv":5081.08209141671,"maxv":-457.3940058552347,"minv":22.27093978838889,"q2v":36.9650784264292,"q5v":43.38226697076658,"q8v":51.99640029342963},"ewpvo":{"avgv":37.66003285139453,"cv":26.905150680060487,"cvpos":0.06800166875260742,"maxpv":83.17410976031623,"maxv":83.17410976031623,"minv":21.433739188293412,"q2v":30.043272244422692,"q5v":37.86244414920806,"q8v":44.37527970320466},"mcw":{"avgv":38.4151784297336,"cv":43.67274159728295,"cvpos":0.7759699624530664,"maxpv":74.99500782187475,"maxv":74.99500782187475,"minv":23.598336006635304,"q2v":32.20254835096054,"q5v":37.67014683053582,"q8v":44.57144530483492}}},"cp":15806.73,"cpc":-0.015607192723078703,"stockCode":"000991"},{"date":"2021-06-15T00:00:00+08:00","dyr":{"ew":0.041556798554172394,"ewpvo":0.04240489648384938,"mcw":0.046861684499662076},"pb":{"y10":{"ew":{"avgv":1.561291372216452,"cv":1.1470078860669284,"cvpos":0.02221308103661045,"maxpv":3.0401512032648133,"maxv":3.0401512032648133,"minv":1.1081858424349267,"q2v":1.2889363336099182,"q5v":1.5468557216964811,"q8v":1.7657682186339134},"ewpvo":{"avgv":1.561291372216452,"cv":1.1470078860669284,"cvpos":0.02221308103661045,"maxpv":3.0401512032648133,"maxv":3.0401512032648133,"minv":1.1081858424349267,"q2v":1.2889363336099182,"q5v":1.5468557216964811,"q8v":1.7657682186339134},"mcw":{"avgv":1.2125556829595059,"cv":0.828473017074662,"cvpos":0.0016454134101192926,"maxpv":2.0454553396629627,"maxv":2.0454553396629627,"minv":0.8230948196929343,"q2v":1.0166132337994673,"q5v":1.1490960413038165,"q8v":1.4297798640133046}}},"pe_ttm":{"y10":{"ew":{"avgv":13.481773471183715,"cv":9.814890257450298,"cvpos":0.055121349238996295,"maxpv":23.634803769316402,"maxv":23.634803769316402,"minv":8.332938340905704,"q2v":10.66178161073309,"q5v":13.730582404896936,"q8v":15.50784054147152},"ewpvo":{"avgv":13.150744979102848,"cv":9.464524566160494,"cvpos":0.029206088029617442,"maxpv":23.38559172707296,"maxv":23.38559172707296,"minv":8.332938340905704,"q2v":10.48639762425508,"q5v":13.380467938932345,"q8v":15.113358153858094},"mcw":{"avgv":8.482454800641682,"cv":7.044280779642274,"cvpos":0.11641299876593994,"maxpv":12.54061899269618,"maxv":12.54061899269618,"minv":6.010118486483975,"q2v":7.341378750851451,"q5v":8.332222893063927,"q8v":9.689492797104775}}},"cp":5105.4489,"cpc":-0.008194796027307813,"stockCode":"000922"}]}

func main() {
	// 获取温度
	httpClient := resty.New()
	// 如果 a 股代码不为空则获取 a 股指数信息
	if len(mainlandStockCodes) > 0 {
		resp, err := httpClient.R().
			SetHeader("Content-Type", "application/json").
			SetBody(map[string]interface{}{
				"token": lixingerToken,
				"date": "latest",
				"stockCodes": mainlandStockCodes,
				"metricsList": []string{
					"pe_ttm.y10.mcw",
					"pe_ttm.y10.ew",
					"pe_ttm.y10.ewpvo",
					"pb.y10.mcw",
					"pb.y10.ew",
					"pb.y10.ewpvo",
					"dyr.mcw",
					"dyr.ew",
					"dyr.ewpvo",
					"cp",
					"cpc",
					"r_cp",
					"r_cpc",
				},
			}).
			Post("https://open.lixinger.com/api/a/index/fundamental")
		if err != nil {
			fmt.Println(err)
			os.Exit(-3)
		}
		fmt.Println(resp)
		fundamental := new(Fundamental)

		err = json.Unmarshal(resp.Body(), fundamental)
		if err != nil {
			fmt.Println(err)
			os.Exit(-4)
		}
		fmt.Println(fundamental.Data)
	}

	// 生成 excel
	// 画图
}
